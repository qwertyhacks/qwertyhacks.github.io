<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>My Private Music</title>
<style>
  :root {
    --bg: #0f1724;
    --card: #111827;
    --muted: #94a3b8;
    --accent: #60a5fa;
  }
  body {
    margin: 0;
    font-family: system-ui, sans-serif;
    background: linear-gradient(180deg, #071020, #071727);
    color: #e6eef8;
    min-height: 100vh;
    display: flex;
    align-items: center;
    justify-content: center;
  }
  .app {
    width: 95%;
    max-width: 900px;
    background: var(--card);
    border-radius: 14px;
    padding: 20px;
    box-shadow: 0 10px 30px rgba(2,6,23,0.6);
  }
  h1 {margin: 0 0 10px; text-align:center;}
  input[type=range] {width:100%;}
  .track {padding:8px; border-radius:8px; cursor:pointer;}
  .track:hover {background:rgba(255,255,255,0.05);}
  .muted {color:var(--muted); font-size:14px;}
  .btn {background:rgba(255,255,255,0.05); border:none; padding:6px 10px; border-radius:8px; cursor:pointer; color:white;}
  #overlay {
    position:fixed; inset:0; display:flex; align-items:center; justify-content:center;
    background:rgba(0,0,0,0.9); z-index:1000;
  }
  #overlay input {
    padding:10px; font-size:24px; text-align:center; border-radius:8px; border:none;
    width:100px; margin-top:10px;
  }
</style>
</head>
<body>
<div id="overlay">
  <div style="text-align:center">
    <h2>Enter 4-digit code</h2>
    <input id="pw" maxlength="4" inputmode="numeric" placeholder="â€¢â€¢â€¢â€¢"><br>
    <button class="btn" id="enter">Unlock</button>
  </div>
</div>

<div class="app" id="app" style="display:none">
  <h1>ðŸŽµ My Private Music</h1>
  <input id="search" placeholder="Search..." style="width:100%;padding:8px;border-radius:8px;border:none;margin-bottom:10px;background:rgba(255,255,255,0.05);color:white">
  <div id="trackList" style="max-height:300px;overflow:auto;margin-bottom:12px"></div>
  <div id="nowPlaying" class="muted">No track selected</div>
  <audio id="audio" controls style="width:100%;margin-top:10px"></audio>
  <div style="margin-top:10px">
    <label>Speed <span id="speedVal">1.00x</span></label>
    <input type="range" id="speed" min="0.5" max="2" step="0.01" value="1">
  </div>
  <div style="margin-top:10px">
    <label>Pitch <span id="pitchVal">0</span> semitones</label>
    <input type="range" id="pitch" min="-12" max="12" step="1" value="0">
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/soundtouchjs@0.1.1/dist/soundtouch.min.js"></script>
<script>
const CODE = "3469";
const overlay = document.getElementById('overlay');
const app = document.getElementById('app');
document.getElementById('enter').onclick = () => {
  if(document.getElementById('pw').value === CODE){
    overlay.remove();
    app.style.display = 'block';
    loadTracks();
  } else alert("Wrong code!");
};

const trackList = document.getElementById('trackList');
const search = document.getElementById('search');
const audio = document.getElementById('audio');
const speed = document.getElementById('speed');
const speedVal = document.getElementById('speedVal');
const pitch = document.getElementById('pitch');
const pitchVal = document.getElementById('pitchVal');
const nowPlaying = document.getElementById('nowPlaying');

let tracks = [];

async function loadTracks(){
  try {
    const res = await fetch('music/tracks.json?cache=' + Math.random());
    tracks = await res.json();
    renderTracks();
  } catch(e){
    trackList.innerHTML = "<div class='muted'>Could not load tracks.json</div>";
  }
}

function renderTracks(){
  const term = search.value.toLowerCase();
  trackList.innerHTML = '';
  tracks.filter(t=>t.name.toLowerCase().includes(term)).forEach(t=>{
    const div = document.createElement('div');
    div.className = 'track';
    div.textContent = t.name;
    div.onclick = () => playTrack(t);
    trackList.appendChild(div);
  });
}

search.oninput = renderTracks;

function playTrack(t){
  audio.src = t.url;
  audio.playbackRate = parseFloat(speed.value);
  nowPlaying.textContent = "Playing: " + t.name;
  audio.play();
}

speed.oninput = ()=>{
  audio.playbackRate = parseFloat(speed.value);
  speedVal.textContent = speed.value + "x";
};

pitch.oninput = ()=>{
  pitchVal.textContent = pitch.value;
  changePitch(parseInt(pitch.value));
};

// ---- real-time pitch shifting ----
let context = new AudioContext();
let source, processor, soundtouchNode, buffer;
function changePitch(semitones){
  if(!audio.src) return;
  const rate = Math.pow(2, semitones / 12);
  audio.playbackRate = rate;
}
</script>
</body>
</html>
